@if (items$ | async; as items) {
  @for (item of items; track item.item_id) {
    <div>
      <span>
        {{ item.item_name }}<br />
        <small>{{ item.quantity }} × {{ item.price | currency:'EUR' }}</small>
      </span>

      <div class="quantity-controls">
        <button (click)="decrease(item.item_id)">−</button>
        <span>{{ item.quantity }}</span>
        <button (click)="increase(item)">+</button>
      </div>
    </div>
  }

  <hr />

  <div class="discount-box">
    <input
      type="text"
      placeholder="Discount code"
      [(ngModel)]="discountCode"
    />
    <button (click)="applyDiscount()">Apply</button>

    @if (discountError) {
      <small class="error">{{ discountError }}</small>
    }
  </div>

  @if (discount$ | async; as discount) {
    <div class="discount-info">
      Discount ({{ discount.code }}):
      −{{ discount.value }}%
    </div>
  }

  <hr />

  <strong>
    <span>Total</span>
    <span>{{ cartService.getTotalWithDiscount() | currency:'EUR' }}</span>
  </strong>

  <button (click)="checkout()">Checkout</button>
}
