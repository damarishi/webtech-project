@if (items$ | async; as items) {

  <div class="cart-card">

    @for (item of items; track item.item_id) {
      <div class="cart-item">

        <div class="item-info">
          <div class="item-name">{{ item.item_name }}</div>
          <div class="item-meta">
            {{ item.quantity }} √ó {{ item.price | currency:'EUR' }}
          </div>
        </div>

        <div class="quantity-controls">
          <button (click)="decrease(item.item_id)">‚àí</button>
          <span>{{ item.quantity }}</span>
          <button (click)="increase(item)">+</button>
        </div>

      </div>
    }

    <div class="divider"></div>

    <div class="discount-box">
      <input
        type="text"
        placeholder="Discount code"
        [(ngModel)]="discountCode"
      />
      <button (click)="applyDiscount()">Apply</button>

      @if (discountError) {
        <small class="error">{{ discountError }}</small>
      }
    </div>

    @if (discount$ | async; as discount) {
      <div class="discount-info">
        @if (discount.source === 'LOYALTY') {
          üéÅ Loyalty Reward -{{ discount.value }}%
        } @else {
          üè∑ Code {{ discount.code }} ‚àí{{ discount.value }}%
        }
      </div>
    }

    <div class="divider"></div>

    <div class="total-row">
      <span>Total</span>
      <strong>{{ cartService.getTotalWithDiscount() | currency:'EUR' }}</strong>
    </div>

    <button
      class="checkout-btn"
      (click)="checkout()"
      [disabled]="checkoutClicked"
    >
      {{ checkoutClicked ? '‚úì' : 'Checkout' }}
    </button>

  </div>
}
